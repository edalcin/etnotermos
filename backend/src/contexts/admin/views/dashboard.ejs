<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %> | EtnoTermos Admin</title>
  <link href="/assets/styles.css" rel="stylesheet">
  <script src="https://unpkg.com/htmx.org@1.9.10"></script>
  <script defer src="https://unpkg.com/alpinejs@3.13.5/dist/cdn.min.js"></script>
</head>
<body class="bg-forest-50 min-h-screen flex flex-col">
  <%- include('partials/header') %>
  <main class="flex-grow container mx-auto px-4 py-8">

<div x-data="{
  stats: null,
  recentChanges: [],
  popularCollections: [],
  loading: true,
  async init() {
    await this.loadDashboard();
  },
  async loadDashboard() {
    try {
      const response = await fetch('/api/v1/admin/dashboard');
      const data = await response.json();
      this.stats = data.statistics;
      this.recentChanges = data.recentChanges || [];
      this.popularCollections = data.popularCollections || [];
    } catch (error) {
      console.error('Error loading dashboard:', error);
    } finally {
      this.loading = false;
    }
  }
}">

  <!-- Header -->
  <div class="mb-8">
    <h1 class="text-3xl font-bold text-forest-700 mb-2">Dashboard Administrativo</h1>
    <p class="text-gray-600">Vis√£o geral do vocabul√°rio controlado e atividades recentes</p>
  </div>

  <!-- Loading State -->
  <div x-show="loading" class="text-center py-12">
    <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-forest-600"></div>
    <p class="text-gray-600 mt-4">Carregando dashboard...</p>
  </div>

  <div x-show="!loading">
    <!-- Statistics Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
      <div class="bg-white rounded-lg shadow-md p-6">
        <div class="flex items-center justify-between">
          <div>
            <div class="text-2xl font-bold text-gray-800" x-text="stats?.totalTerms || 0"></div>
            <div class="text-gray-600">Termos Totais</div>
            <div class="text-sm text-gray-500 mt-1">
              <span x-text="stats?.activeTerms || 0"></span> ativos
            </div>
          </div>
          <div class="text-forest-600 text-4xl">üìö</div>
        </div>
      </div>

      <div class="bg-white rounded-lg shadow-md p-6">
        <div class="flex items-center justify-between">
          <div>
            <div class="text-2xl font-bold text-gray-800" x-text="stats?.totalRelationships || 0"></div>
            <div class="text-gray-600">Relacionamentos</div>
            <div class="text-sm text-gray-500 mt-1">
              Sem√¢nticos
            </div>
          </div>
          <div class="text-forest-600 text-4xl">üîó</div>
        </div>
      </div>

      <div class="bg-white rounded-lg shadow-md p-6">
        <div class="flex items-center justify-between">
          <div>
            <div class="text-2xl font-bold text-gray-800" x-text="stats?.totalCollections || 0"></div>
            <div class="text-gray-600">Cole√ß√µes</div>
            <div class="text-sm text-gray-500 mt-1">
              Tem√°ticas
            </div>
          </div>
          <div class="text-forest-600 text-4xl">üè∑Ô∏è</div>
        </div>
      </div>

      <div class="bg-white rounded-lg shadow-md p-6">
        <div class="flex items-center justify-between">
          <div>
            <div class="text-2xl font-bold text-gray-800" x-text="stats?.totalNotes || 0"></div>
            <div class="text-gray-600">Notas</div>
            <div class="text-sm text-gray-500 mt-1">
              Anota√ß√µes
            </div>
          </div>
          <div class="text-forest-600 text-4xl">üìù</div>
        </div>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
      <a href="/terms/new" class="bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow">
        <div class="text-forest-600 text-4xl mb-3">‚ûï</div>
        <h3 class="text-xl font-semibold text-gray-800 mb-2">Novo Termo</h3>
        <p class="text-gray-600">Adicionar um novo termo ao vocabul√°rio controlado</p>
      </a>

      <a href="/relationships/new" class="bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow">
        <div class="text-forest-600 text-4xl mb-3">üîó</div>
        <h3 class="text-xl font-semibold text-gray-800 mb-2">Novo Relacionamento</h3>
        <p class="text-gray-600">Criar relacionamento sem√¢ntico entre termos</p>
      </a>

      <a href="/collections/new" class="bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow">
        <div class="text-forest-600 text-4xl mb-3">üè∑Ô∏è</div>
        <h3 class="text-xl font-semibold text-gray-800 mb-2">Nova Cole√ß√£o</h3>
        <p class="text-gray-600">Criar uma nova cole√ß√£o tem√°tica de termos</p>
      </a>
    </div>

    <!-- Recent Changes and Popular Collections -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <!-- Recent Changes -->
      <div class="bg-white rounded-lg shadow-md p-6">
        <h2 class="text-xl font-semibold text-gray-800 mb-4">Altera√ß√µes Recentes</h2>

        <div x-show="recentChanges.length === 0" class="text-center py-8 text-gray-600">
          Nenhuma altera√ß√£o recente
        </div>

        <div x-show="recentChanges.length > 0" class="space-y-4">
          <template x-for="change in recentChanges" :key="change._id">
            <div class="border-l-4 border-forest-600 bg-forest-50 p-4 rounded-r-lg">
              <div class="flex items-start justify-between mb-2">
                <div class="font-semibold text-gray-800" x-text="change.action"></div>
                <div class="text-xs text-gray-500" x-text="new Date(change.timestamp).toLocaleString('pt-BR')"></div>
              </div>
              <div class="text-sm text-gray-700">
                <span x-text="change.entityType"></span>:
                <span class="font-medium" x-text="change.entityId"></span>
              </div>
              <div x-show="change.admin" class="text-xs text-gray-600 mt-1">
                Por: <span x-text="change.admin"></span>
              </div>
            </div>
          </template>
        </div>

        <div class="mt-6">
          <a href="/audit" class="text-forest-600 hover:text-forest-700 font-medium text-sm">
            Ver todos os logs ‚Üí
          </a>
        </div>
      </div>

      <!-- Popular Collections -->
      <div class="bg-white rounded-lg shadow-md p-6">
        <h2 class="text-xl font-semibold text-gray-800 mb-4">Cole√ß√µes Populares</h2>

        <div x-show="popularCollections.length === 0" class="text-center py-8 text-gray-600">
          Nenhuma cole√ß√£o criada ainda
        </div>

        <div x-show="popularCollections.length > 0" class="space-y-4">
          <template x-for="collection in popularCollections" :key="collection._id">
            <a
              :href="`/collections/${collection._id}`"
              class="block p-4 border border-gray-200 rounded-lg hover:border-forest-400 hover:bg-forest-50 transition-colors"
            >
              <div class="font-semibold text-forest-700 mb-1" x-text="collection.name"></div>
              <div class="text-sm text-gray-600 mb-2" x-text="collection.description || 'Sem descri√ß√£o'"></div>
              <div class="flex items-center justify-between text-xs text-gray-500">
                <span x-text="`${collection.termCount || 0} termos`"></span>
                <span x-show="collection.modified" x-text="`Atualizada ${new Date(collection.modified).toLocaleDateString('pt-BR')}`"></span>
              </div>
            </a>
          </template>
        </div>

        <div class="mt-6">
          <a href="/collections" class="text-forest-600 hover:text-forest-700 font-medium text-sm">
            Ver todas as cole√ß√µes ‚Üí
          </a>
        </div>
      </div>
    </div>

    <!-- Z39.19 Compliance Status -->
    <div class="bg-blue-50 border-l-4 border-blue-600 p-6 rounded-r-lg mt-8">
      <h3 class="font-semibold text-blue-900 mb-3">Status de Conformidade ANSI/NISO Z39.19-2005</h3>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
        <div>
          <div class="text-blue-800 font-semibold" x-text="stats?.hierarchicalRelationships || 0"></div>
          <div class="text-blue-700">Rela√ß√µes Hier√°rquicas (BT/NT)</div>
        </div>
        <div>
          <div class="text-blue-800 font-semibold" x-text="stats?.associativeRelationships || 0"></div>
          <div class="text-blue-700">Rela√ß√µes Associativas (RT)</div>
        </div>
        <div>
          <div class="text-blue-800 font-semibold" x-text="stats?.equivalenceRelationships || 0"></div>
          <div class="text-blue-700">Rela√ß√µes de Equival√™ncia (USE/UF)</div>
        </div>
        <div>
          <div class="text-blue-800 font-semibold" x-text="stats?.termsWithDefinitions || 0"></div>
          <div class="text-blue-700">Termos com Defini√ß√£o</div>
        </div>
      </div>
    </div>
  </div>
</div>

  </main>
  <%- include('partials/footer') %>
</body>
</html>
