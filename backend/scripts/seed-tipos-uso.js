// Script para popular o banco com tipos de uso de plantas
// Garante que n√£o haver√° duplicados

import { MongoClient, ObjectId } from 'mongodb';
import dotenv from 'dotenv';

dotenv.config();

const MONGO_URI = process.env.MONGO_URI || 'mongodb://localhost:27017/etnodb';

// Lista de termos para tipos de uso de plantas
const tiposUso = [
  'aliment√≠cio',
  'ambiental',
  'anticorpos',
  'antidepressivo',
  'antidiab√©tico',
  'antiespasm√≥dico',
  'antigripal',
  'antiss√©ptico',
  'antit√©rmico',
  'antiviral',
  'apertar os dentes',
  'apetite',
  'arame',
  'arranh√µes',
  'arrepiamento',
  'artesanal',
  'artesanato',
  'artrite',
  'asma',
  'asma br√¥nquica',
  'asma e tosse',
  'azia',
  'baixa a press√£o',
  'baixar a febre',
  'baixar a press√£o',
  'baixo astral',
  'balan√ßo',
  'banho',
  'batidas',
  'bexiga',
  'bicho de p√©',
  'bronquite',
  'bronquite asm√°tica',
  'bronquites',
  'b√≥cio',
  'cabelo',
  'caibro',
  'calmante',
  'calmante (nervoso)',
  'calmante infantil',
  'calmante natural',
  'calmante para o cora√ß√£o',
  'calmante para os nervos',
  'calos',
  'canal',
  'cancro',
  'cansado',
  'cansa√ßo',
  'cardiorritmo',
  'catarro',
  'catarro no peito',
  'catuaba',
  'causar v√¥mito',
  'caxumba',
  'ca√ßa',
  'cerne',
  'cesto',
  'chagas',
  'chaqueiro',
  'ch√°',
  'ch√° (bebida recreativa)',
  'ch√° de beb√™',
  'cicatrizante',
  'cicatrizar',
  'cicatrizar feridas',
  'cicatrizar feridas e √∫lceras',
  'cicatriza√ß√£o',
  'cicatriza√ß√£o de feridas',
  'circula√ß√£o',
  'circula√ß√£o do sangue',
  'cirrose',
  'clister',
  'cobreiro',
  'coceira',
  'coceiras',
  'colesterol',
  'colesterol alto',
  'colesterol e diabetes',
  'coluna',
  'combust√≠vel',
  'comida',
  'congest√£o',
  'constru√ß√£o',
  'contus√£o',
  'contus√µes',
  'coqueluche',
  'corante',
  'cora√ß√£o',
  'corpo',
  'corpo ruim',
  'corrimento',
  'cortes',
  'cosm√©tico',
  'cozinha',
  'crescer cabelo',
  'cuidados pessoais',
  'cura',
  'curar ins√¥nia',
  'c√≥lica',
  'c√≥lica de beb√™',
  'c√≥lica de rins',
  'c√≥lica de √∫tero',
  'c√≥lica menstrual',
  'c√≥lica renal',
  'c√≥licas',
  'c√≥licas do f√≠gado e est√¥mago',
  'c√≥licas e dores',
  'dar energia',
  'dar sono',
  'defumador',
  'defuma√ß√£o',
  'dengue',
  'dentadura',
  'dente',
  'depress√£o',
  'depurativo',
  'depurativo do sangue',
  'derrames',
  'descarrego',
  'desinfetante',
  'desintoxicar',
  'desintoxica√ß√£o alimentar',
  'des√¢nimo',
  'diabete',
  'diabetes',
  'diafor√©tico',
  'diarr√©ia',
  'digestivo',
  'digest√£o',
  'disenteria',
  'disfun√ß√£o er√©til',
  'diur√©tico',
  'doce',
  'doen√ßa do cora√ß√£o',
  'doen√ßa ven√©rea',
  'doen√ßas',
  'doen√ßas ven√©reas',
  'dor',
  'dor de barriga',
  'dor de cabe√ßa',
  'dor de dente',
  'dor de est√¥mago',
  'dor de garganta',
  'dor de ouvido',
  'dor de rins',
  'dor do peito',
  'dor lombar',
  'dor na bacia',
  'dor na barriga',
  'dor na coluna',
  'dor na espinha',
  'dor nas costas',
  'dor nas juntas',
  'dor nas pernas',
  'dor no corpo',
  'dor no est√¥mago',
  'dor no f√≠gado',
  'dor no intestino',
  'dor no peito',
  'dor no pulm√£o',
  'dor nos ossos',
  'dor nos rins',
  'dores',
  'dores e c√≥licas',
  'dores musculares',
  'dores na bexiga',
  'dores nas articula√ß√µes',
  'dores no corpo',
  'dores no est√¥mago',
  'dores no geral',
  'dores no peito',
  'dores no √∫tero',
  'dormir',
  'd√∫vida',
  'edema',
  'emagrecer',
  'emagrecimento',
  'energia',
  'enferrujado',
  'enjoo',
  'envenenamento',
  'enxaqueca',
  'equimoses',
  'erup√ß√£o cut√¢nea',
  'escorbuto',
  'escoria√ß√µes',
  'escorregadio',
  'esfolantes',
  'esgotamento',
  'esgotamento f√≠sico',
  'espectro',
  'espinha',
  'espinhela ca√≠da',
  'espiritual',
  'estimulante',
  'estimulante sexual',
  'estresse',
  'est√¥mago',
  'est√¥mago e f√≠gado',
  'excitante',
  'expectorante',
  'falta de apetite',
  'falta de ar',
  'falta de mem√≥ria',
  'febre',
  'febres',
  'ferida',
  'feridas',
  'ferimento',
  'ferimentos',
  'fio',
  'fisioter√°pico',
  'flatul√™ncia',
  'fome',
  'fonte gen√©tica',
  'fortificante',
  'fraqueza',
  'fraturas',
  'frieira',
  'frieiras',
  'frio',
  'fumo',
  'fur√∫nculo',
  'fur√∫nculos',
  'f√≠gado',
  'f√≠gado e est√¥mago',
  'f√≠gado e rins',
  'f√¥lego',
  'garganta',
  'garganta inflamada',
  'gases',
  'gastrite',
  'gazes',
  'gordura no f√≠gado',
  'gota',
  'gripe',
  'gripe e resfriado',
  'gripe e tosse',
  'gripes',
  'hemorragia',
  'hemorroidas',
  'hepatite',
  'herpes',
  'higiene',
  'hipertens√£o',
  'hipotens√£o',
  'ict√©ricia',
  'impingem',
  'impot√™ncia',
  'impot√™ncia sexual',
  'incha√ßo',
  'incha√ßo nas pernas',
  'incontin√™ncia urin√°ria',
  'infec√ß√£o',
  'infec√ß√£o de garganta',
  'infec√ß√£o de pele',
  'infec√ß√£o de urina',
  'infec√ß√£o de √∫tero',
  'infec√ß√£o intestinal',
  'infec√ß√£o no sangue',
  'infec√ß√£o pulmonar',
  'infec√ß√£o renal',
  'infec√ß√£o urin√°ria',
  'inflama√ß√£o',
  'inflama√ß√£o de garganta',
  'inflama√ß√£o de √∫tero',
  'inflama√ß√£o do √∫tero',
  'inflama√ß√£o na bexiga',
  'inflama√ß√£o na garganta',
  'inflama√ß√£o no corpo',
  'inflama√ß√£o no f√≠gado',
  'inflama√ß√£o no √∫tero',
  'inflama√ß√µes',
  'inseticida',
  'ins√¥nia',
  'intestino',
  'intestino preso',
  'intoxica√ß√£o',
  'intoxica√ß√£o do f√≠gado',
  'labirintite',
  'laxante',
  'limpeza',
  'limpeza do √∫tero',
  'limpeza uterina',
  'linfoma',
  'lit√∫rgico',
  'lubrificante',
  'luxa√ß√£o',
  'luxa√ß√µes',
  'l√∫dico',
  'machucado',
  'machucados',
  'madeira',
  'mal de parkinson',
  'mal estar',
  'mal√°ria',
  'mancha na pele',
  'mau h√°lito',
  'medicinal',
  'mem√≥ria',
  'menopausa',
  'menstrua√ß√£o',
  'menstrua√ß√£o atrasada',
  'menstrua√ß√£o dolorosa',
  'micoses',
  'mioma',
  'mordida de cobra',
  'm√° digest√£o',
  'm√≠stico',
  'm√≥veis',
  'm√∫sculos',
  'nervosismo',
  'nervoso',
  'nevralgia',
  'n√°usea',
  'n√°useas',
  'olho',
  'olho gordo',
  'ornamental',
  'ossos',
  'outros',
  'ouvido',
  'palpita√ß√µes',
  'pancadas',
  'panos',
  'paralisia',
  'parasitas',
  'parto',
  'pedra na ves√≠cula',
  'pedra no rim',
  'pedra nos rins',
  'peito',
  'pele',
  'perda de apetite',
  'perda de peso',
  'pernas',
  'picada de abelha',
  'picada de aranha',
  'picada de cobra',
  'picada de insetos',
  'picada de mosquito',
  'picadas',
  'picadas de insetos',
  'pigmenta√ß√£o',
  'piolho',
  'piorreia',
  'pneumonia',
  'ponta de flecha',
  'porrete',
  'postema',
  'press√£o',
  'press√£o alta',
  'press√£o baixa',
  'problema no cora√ß√£o',
  'problemas de f√≠gado',
  'problemas de pele',
  'problemas de pr√≥stata',
  'problemas de rins',
  'problemas digestivos',
  'problemas do cora√ß√£o',
  'problemas do est√¥mago',
  'problemas do f√≠gado',
  'problemas estomacais',
  'problemas na bexiga',
  'problemas na coluna',
  'problemas na garganta',
  'problemas na pr√≥stata',
  'problemas no cora√ß√£o',
  'problemas no f√≠gado',
  'problemas no pulm√£o',
  'problemas nos rins',
  'problemas pulmonares',
  'problemas renais',
  'problemas respirat√≥rios',
  'pr√≥stata',
  'psor√≠ase',
  'pulm√£o',
  'purgante',
  'queimadura',
  'queimaduras',
  'queixo',
  'quengo',
  'qu√≠mico',
  'rala√ß√£o',
  'reconstituinte',
  'refrescante',
  'regulador da press√£o arterial',
  'regulador menstrual',
  'relaxante',
  'remediar',
  'rem√©dio',
  'resfriado',
  'resfriados',
  'respirat√≥rio',
  'reten√ß√£o de l√≠quidos',
  'reumatismo',
  'revestimento',
  'revigorar',
  'rins',
  'ritual',
  'rouquid√£o',
  'sangramento',
  'sangue',
  'sarampo',
  'sarna',
  'sa√∫de',
  'secre√ß√£o',
  'sedativo',
  'seio',
  'sinusite',
  'sistema nervoso',
  'solu√ßo',
  'sono',
  'son√≠fero',
  'suor',
  'sustento',
  'taquicardia',
  'tecnologia',
  'tecnologia social',
  'tecnol√≥gico',
  'tifo',
  'tonificante',
  'tontura',
  'tor√ß√£o',
  'tosse',
  'tosses',
  'tranquilizante',
  'traumatismo',
  'triglicer√≠deos',
  'tuberculose',
  'tumor',
  'tumores',
  't√≥xico',
  'uropatia',
  'urtic√°ria',
  'utens√≠lio',
  'utens√≠lio dom√©stico',
  'utens√≠lios',
  'varizes',
  'veias',
  'velas',
  'veneno',
  'verme',
  'vermes',
  'vermicida',
  'verrugas',
  'vertigem',
  'ves√≠cula',
  'vias urin√°rias',
  'virose',
  'v√¥mito',
  'xarope',
  '√∫lcera',
  '√∫lceras',
];

async function seedTiposUso() {
  const client = new MongoClient(MONGO_URI);

  try {
    await client.connect();
    console.log('Conectado ao MongoDB');

    const db = client.db('etnodb');
    const terms = db.collection('etnotermos');
    const auditLogs = db.collection('etnotermos-audit-logs');

    // Remover duplicados da lista usando Set
    const termosUnicos = [...new Set(tiposUso)].sort();
    console.log(`\nTotal de termos √∫nicos: ${termosUnicos.length}`);

    // Verificar quais termos j√° existem no banco
    const termosExistentes = await terms
      .find({ prefLabel: { $in: termosUnicos } })
      .project({ prefLabel: 1 })
      .toArray();

    const labelsExistentes = new Set(termosExistentes.map((t) => t.prefLabel));
    const termosParaInserir = termosUnicos.filter((t) => !labelsExistentes.has(t));

    if (termosParaInserir.length === 0) {
      console.log('\n‚úÖ Todos os termos j√° existem no banco de dados!');
      console.log(`   Total de termos j√° cadastrados: ${termosExistentes.length}`);
      return;
    }

    console.log(`\nTermos j√° existentes: ${termosExistentes.length}`);
    console.log(`Novos termos a inserir: ${termosParaInserir.length}`);

    // Criar documentos para os novos termos
    const now = new Date();
    const novosTermos = termosParaInserir.map((label) => ({
      _id: new ObjectId(),
      prefLabel: label,
      altLabels: [],
      hiddenLabels: [],
      definition: '',
      scopeNote: '',
      historyNote: '',
      example: '',
      qualifier: '',
      termType: 'preferred',
      status: 'active',
      useFor: [],
      useTerm: null,
      replacedBy: null,
      deprecatedDate: null,
      deprecationNote: '',
      facets: {},
      sourceIds: [],
      collectionIds: [],
      version: 1,
      createdAt: now,
      updatedAt: now,
    }));

    // Inserir os novos termos
    if (novosTermos.length > 0) {
      const result = await terms.insertMany(novosTermos);
      console.log(`\n‚úÖ ${result.insertedCount} novos termos inseridos com sucesso!`);

      // Criar logs de auditoria para cada termo inserido
      const auditLogDocs = novosTermos.map((term) => ({
        _id: new ObjectId(),
        entityType: 'Term',
        entityId: term._id,
        action: 'create',
        changes: {
          after: term,
        },
        timestamp: now,
        metadata: {
          admin: 'seed-script',
          source: 'seed-tipos-uso.js',
        },
      }));

      await auditLogs.insertMany(auditLogDocs);
      console.log(`‚úÖ ${auditLogDocs.length} logs de auditoria criados`);
    }

    // Relat√≥rio final
    console.log('\nüìä RELAT√ìRIO FINAL:');
    console.log(`   Total de termos √∫nicos na lista: ${termosUnicos.length}`);
    console.log(`   Termos j√° existentes no banco: ${termosExistentes.length}`);
    console.log(`   Novos termos inseridos: ${novosTermos.length}`);
    console.log(`   Total de termos no banco agora: ${termosUnicos.length}`);

    if (termosExistentes.length > 0) {
      console.log('\nüìù Termos que j√° existiam:');
      termosExistentes.slice(0, 10).forEach((t) => console.log(`   - ${t.prefLabel}`));
      if (termosExistentes.length > 10) {
        console.log(`   ... e mais ${termosExistentes.length - 10} termos`);
      }
    }

    if (novosTermos.length > 0) {
      console.log('\nüìù Alguns dos novos termos inseridos:');
      novosTermos.slice(0, 10).forEach((t) => console.log(`   - ${t.prefLabel}`));
      if (novosTermos.length > 10) {
        console.log(`   ... e mais ${novosTermos.length - 10} termos`);
      }
    }

    console.log('\n‚úÖ Processo conclu√≠do com sucesso!');
  } catch (error) {
    console.error('‚ùå Erro ao popular banco de dados:', error);
    process.exit(1);
  } finally {
    await client.close();
  }
}

seedTiposUso();
